<html>
  <head>
    <title><%=@report_name%></title>
    <%= stylesheet_link_tag fancy_or_high_contrast_touch %>
    <link href="/stylesheets/report.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/report_print.css" media="print" rel="stylesheet" type="text/css" />
    <%= javascript_include_tag("jquery") %>
    <%= javascript_include_tag("jquery.table2CSV.min") %>
    <script>
      function eportToCSV(){
         $('#hsa_performance_report').table2CSV()
      }
    </script>
  </head>
  <body>
    <div class="btn-menu">
      <%params[:format] = 'pdf'%>
      <%select_report_criteria = '/report/select?report_type=' +@report_type +'&query=' + @query%>

      <button id="finish_button" class="button green" onclick="window.location = '/clinic'"><span>Finish</span></button>
      <button id="export_button" class="button green" onclick="eportToCSV();"><span>Export to CSV</span></button>
      <button id="back_button" class="button red" onclick="window.location = '<%=select_report_criteria%>'"><span>Back</span></button>
    </div>

    <form id="frmMain" action="/report/patient_analysis_report" method="post">
      <input type="hidden" id="start_date" name="start_date" value="<%= @start_date.to_date.strftime('%d-%m-%Y') %>" />
      <input type="hidden" id="end_date" name="end_date" value="<%= @end_date.to_date.strftime('%d-%m-%Y') %>" />
    </form>

    <div>
    <fieldset class="main_fieldset">
      <legend class="main_legend" style="color:white; background-color:green;">
        HSA Performance Report
      </legend>
      <table cellspacing="0" width="100%" id="hsa_performance_report">
        <thead>
          <tr>
            <td colspan ="6"><%= "Filter Info: Grouping - #{@grouping.capitalize} "%></td>
          </tr>
          <tr>
            <td colspan="6"></td>
          </tr>
          <tr>
            <td class="cellleft cellbottom celltop main-table-cell" style="font-weight: bold;">Health Center</td>
            <td class="cellleft cellbottom celltop main-table-cell" style="font-weight: bold;">HSA Name</td>
            <td class="cellleft cellbottom celltop main-table-cell" style="font-weight: bold; text-align: center;">Clients Enrolled(Total)</td>
            <td class="cellleft cellbottom celltop main-table-cell" style="font-weight: bold; text-align: center;">New Enrollments</td>
            <td class="cellleft cellbottom celltop main-table-cell" style="font-weight: bold; text-align: center;">On-Time ANC Rate(%)</td>
            <td class="cellleft cellbottom cellright celltop main-table-cell" style="font-weight: bold; text-align: center;">Facility Delivery Rate(%)</td>
          </tr>
        </thead>

        <%  (@report.reverse.map || []).each do |data_values|%>
		<tr>
            <td width="25%" colspan = 6 class="cellleft cellbottom main-table-cell" style="background-color:ddd; text-align:center;font-weight: bold; font-size: large; font-style: italic;">
		<%= @grouping.humanize + " beginning "+ data_values[:start_date].to_date.strftime("%d-%b-%Y") + " ending " + data_values[:end_date].to_date.strftime("%d-%b-%Y")%></td>
        </tr>
        
          <% data_values[:hc_details].each do |health_center_details| %>
	      <tr> 
		<td colspan = 6 class="cellleft cellbottom celltop cellright main-table-cell" style="text-align:left;"><%= health_center_details[:health_center] %></td>
	      </tr>
              <% health_center_details[:hsa_details].each do |details| %>
		      <tr>
		      <td class="cellleft  main-table-cell"> &nbsp;</td>
		      <td class="cellleft cellbottom main-table-cell" style="text-align:left;"><%= details[:name] %></td>
		      <td class="cellleft cellbottom main-table-cell" style="text-align:center;"><%= details[:total] %></td>
		      <td class="cellleft cellbottom main-table-cell" style="text-align:center;"><%= details[:new] %></td>
		      <td class="cellleft cellbottom main-table-cell" style="text-align:center;"><%= details[:on_time] %></td>
		      <td class="cellleft cellbottom cellright main-table-cell" style="text-align:center;"><%= details[:facility_rate] %></td>
		      </tr>
              <% end %>
           <% end %>
        
        <% end %>
      </table>

    </fieldset>

    </div>

  </body>
</html>
